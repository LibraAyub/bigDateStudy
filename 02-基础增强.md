# 02-Linux增强

## 1. Zookeeper

### 1.1 特性

```
分布式,小文件存储系统,以kb为单位.
1.全局数据一致性
2.可靠性
3.顺序性
4.数据更新原子性
5.实时性
```

### 1.2 角色

```
Leader:核心
	事务请求(写操作)的唯一调度和处理者.保证集群事务处理的顺序性.集群内部各个服务器的调度者.
Follower:
	处理非事务性(读)请求.,转发事务请求给Leader;参与集群Leader的选举.
	
还可增加观察者,非事务请求比较多的时候.
Observer:
	观察Zookeeper最新状态;对于非事务请求(读)的横向扩展;转发事务请求给Leader;不会参与Leader投票.
```

### 1.3 集群注意

```
1.检测集群时间高度一致.
2.检测防火墙是否关闭.
3.检测主机Ip映射有没有配置.
```

## 2 .zookeeper数据模型

```
1.Znode兼具文件和目录两种特点:每一个节点即像文件一样维护数据,元信息,
2.Znode具有原子性操作
3.Znode存储数据大小有限制
4.通过路径引用
```

### 2.1节点类型

```
临时节点:该节点的生命周期依赖于创建他们的对话,一旦回话结束就将自动被删除.;不能拥有子节点.
永久节点:该节点的生命周期不依赖于会话.
每个节点还有一个特性:序列化,每个子节点下唯一.每一个节点都可以当做一个路径.
```

### 2.2 节点属性

```
每次对节点set操作dataVersion的值都会增加1;
cversion:当znode的子节点有变化时,cversion的值增加1;
cZxid:Znode创建事务的id
mZxid:被修改事务id 
ephemeralOwner:  如果不为0  即为永久节点.临时节点和sessionb绑定的
```

## 3.ZooKeeper shell

```
查看进程jps

zkCli.sh -service ip  需要进入到bin目录
创建临时节点:
	create [-s] [-e] path /date ac1
	顺序节点:create -s path /test 123
	临时节点:create -e path  /test 234
获取节点:
	ls	/
	get	/hello
更新节点:
	set	path data [version]
删除节点:不能有子节点或者Rmr 递归
	delete path
```

## 4.ZooKeeper Watcher

```
三个过程:
	客户端想服务端注册watcher服务端事件触发Watcher,客户端回调Watcher得到触发事件情况.
特点:
	一次性触发;事件封装;事件异步发送;先注册再触发
	
设置监听:
	get path watch
```
## 5.选举机制

```
投票大于半数则胜出.服务器ID;选举状态;数据id;逻辑时钟.
```

```
全新集群:1.每个机器都给自己投票;2.投票数过半选举结束;

	刚启动,不过半的处于looking状态.大部分参考的myid的值;值比较大容易当leader.

非全新集群的选举:需要加入数据数据ID;服务器ID和逻辑时钟.
数据id:越大version越大;
标准:
	1.逻辑时钟是否一样,小的忽略;

	2.统一逻辑时钟,逻辑时钟权重最大;

	3.数据id越大越可能,相同就比较服务器id大的.
```

## 6.应用

### 1.数据发布和订阅(配置中心)

```
1.统一管理的数据不能太大;
流程:
	1.所有订阅者初次启动都去指定的节点获取相关订阅信息;
	2.获取数据的同时,还要设置监听,监听节点数据变化;
	3.一旦节点数据改变,监听就会触发,我们的各个应用都会接收到事件的通知,从而获取新的配置信息;
	4.还要再次设置监听.
```

### 2.命名服务

```
通过使用命名服务,客户端应用能够根据指定名字来获取资源或资料的地址.
```

### 3.分布式锁

```
保证数据强一致性
1.要求所有的应用首先去zk上指定目录创建节点.这个节点的要求(临时节点,非序列化)
2.谁创建成功谁就获得访问数据文件的权限.
3.操作完成断开/.
```

## 7.网络编程

```
三要素:
ip:计算机在网络中的唯一标识;InetAddress
端口号:是一台机器上不同程序的标识;65535
协议:通信双方都遵守达成的传输数据的格式.UDP,TCP
```

## 8.RPC

```
rpc是协议
网络协议和网络IO模型对其透明
信息格式对其透明
跨语言能力
```